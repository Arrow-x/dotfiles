# vim: filetype=sh
# Basic Settings
set hidden true
set ignorecase true
set icons true

set shell zsh
set shellopts '-euy'
set ifs "\n"
set filesep "\n"  # default already

# Custom Functions
cmd setwallpaper %nitrogen --set-zoom-fill --save "$f" >/dev/null 2>&1

# Archive bindings
cmd unarchive ${{
 case "$f" in
#      *.zip) unzip "$f" ;;
      *.tar.gz) tar -xvf "$f" ;;
      *.tar.bz2) tar -xvf "$f" ;;
      *.tar.xz) tar -xvf "$f" ;;
      *.tar) tar -xvf "$f" ;;
      *) 7z x "$f";;
  esac
}}

# all of this just to disable the flickering
cmd open %setsid -f sh -c '(case $(mimetype -M -b "$f") in application/x-sharedlib) (setsid -f "$f" >/dev/null 2>&1);; application/x-shellscript) (setsid -f sh -c "$f" >/dev/null 2>&1);; application/x-executable) (setsid -f "$f" >/dev/null 2>&1);; *) (setsid -f mimeopen -n -M "$f" >/dev/null 2>&1);; esac)' >/dev/null 2>&1

# Trash bindings
cmd trash ${{
  files=$(printf "$fx" | tr '\n' ';')
  while [ "$files" ]; do
    file=${files%%;*}

    trash-put "$(basename "$file")"
    if [ "$files" = "$file" ]; then
      files=''
    else
      files="${files#*;}"
    fi
  done
}}

cmd restore_trash ${{
  trash-restore
}}

cmd bulkrenamevimv ${{
  vimv --git -- $fx
  lf -remote "send $id load"
  lf -remote "send $id unselect"
}}

cmd chmod_plus_x ${{
  chmod +x $fx
  lf -remote "send $id reload"
}}

cmd chmod_minus_x ${{
  chmod -x $fx
  lf -remote "send $id reload"
}}

# y (select for copy) and P to paste soft-link
# d (select for cut) and P to paste hard-link
cmd link %{{
    set -- $(cat ~/.local/share/lf/files)
    mode="$1"
    shift
    if [ "$#" -lt 1 ]; then
        lf -remote "send $id echo no files to link"
        exit 0
    fi
    case "$mode" in
        # symbolically copy mode is indicating a soft link
        copy) ln -sr -t . -- "$@";;
        # while a move mode is indicating a hard link
        move) ln -t . -- "$@";;
    esac
    rm ~/.local/share/lf/files
    lf -remote "send clear"
}}

cmd git_pull %git pull origin 

map P :link

cmd dragon %dragon-drop -a -x $fx
cmd dragon-stay %dragon-drop -a $fx
cmd dragon-individual %dragon-drop $fx
cmd cpdragon %cpdragon
cmd mvdragon %mvdragon
cmd dlfile %dlfile

# Bindings
# Dragon Mapping
map dr dragon
map ds dragon-stay
map di dragon-individual
map dm mvdragon
map dc cpdragon
map dl dlfile

# Remove some defaults
map m
# map o
map n
map "'"
map '"'
map d
map w

map au unarchive

map ma chmod_plus_x
map mr chmod_minus_x
map mp git_pull

# Basic Functions
map . set hidden!
map DD delete
map p paste
map x cut
map y copy
map R reload
map bg setwallpaper
map C clear
map <f-2> bulkrenamevimv

map dd trash
map dR restore_trash

# Movement
map gD cd ~/File/Documents
map gd cd ~/Downloads
map gp cd ~/Pictures
map gl cd ~/.local
map gc cd ~/.config
map gF cd ~/File
map gH cd ~/File/Homework/H-Games
map gp cd ~/File/Projects
map gt cd ~/File/Tutorials
map gr cd ~/File/Examples\ and\ Refrences

set previewer ~/.config/lf/previewer.sh
set cleaner ~/.config/lf/clear_img.sh
