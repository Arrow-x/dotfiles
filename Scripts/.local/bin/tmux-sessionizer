#!/bin/sh

selected=$(find -L "/home/arrowx/Public" "/home/arrowx/File/Projects/Godot" "/home/arrowx/File/Projects/Scripts" -mindepth 1 -maxdepth 1 -type d | fzf)

[ -z "$selected" ] && exit 0

selected_name=$(basename "$selected" | tr . _)
tmux_running=$(pgrep tmux)

if [ ! "$TMUX" ] && [ ! "$tmux_running" ]; then
	exit
fi

case "$1" in
	-we | --new-window-nvim)
		tmux rename-window "$(basename "$selected")"
		if [ "$1" = "-n" ]; then
			tmux new-window nvim "$selected"
			exit
		fi
		;;
	-wcd | --new-window-cd)
		tmux rename-window "$(basename "$selected")"
		if [ "$1" = "-n" ]; then
			tmux new-window -c "$selected"
			exit
		fi
		;;
	-se | --new-session-nvim)
		if ! tmux has-session -t="$selected_name" 2>/dev/null; then
			tmux new-session -ds "$selected_name" nvim "$selected"
		fi
		tmux switch-client -t "$selected_name"
		;;
	-scd | --new-session-cd)
		if ! tmux has-session -t="$selected_name" 2>/dev/null; then
			tmux new-session -ds "$selected_name" -c "$selected"
		fi

		tmux switch-client -t "$selected_name"
		;;
esac
