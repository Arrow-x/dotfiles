#!/bin/sh
UB_PID_FILE="/tmp/.$(uuidgen)"
ueberzugpp layer --no-stdin --silent --use-escape-codes --pid-file "$UB_PID_FILE"
UB_PID=$(cat "$UB_PID_FILE")
export SOCKET=/tmp/ueberzugpp-"$UB_PID".socket
pics="/home/arrowx/Pictures/"
resault="$(fd -t f -L -0 . "$pics" -E Vertical -E .tmsu | xargs --null ls -t | fzf \
    --preview-window='up,30' \
    --preview='ueberzugpp cmd -s $SOCKET -a add -x 1 -y 1 --max-width $FZF_PREVIEW_COLUMNS --max-height $FZF_PREVIEW_LINES -f {}'\
    --bind 'ctrl-l:execute(xdg-open {})' --bind 'ctrl-d:reload(trash {}; fd -t f -L -0 . $pics | xargs --null ls -t )' \
    --header "CTRL-d to Delete | CTRL-l to open without closing")"

ueberzugpp cmd -s "$SOCKET" -a exit
rm "$UB_PID_FILE"

if [ -z "$resault" ]; then
    exit 2
fi
set_bg "$resault">/dev/null
