#!/bin/bash
ueberzugpp layer --no-stdin --silent &
UB_PID=$!

# sleep some time for U++ startup
sleep 0.2

export SOCKET=/tmp/ueberzugpp-$UB_PID.socket

# TODO: support a config file for the folder of pictures

PICS="/home/arrowx/Pictures/"

fd -t f -L -0 . $PICS -E Vertical | xargs --null ls -t | fzf \
    --preview-window='up,30' \
    --preview='ueberzugpp cmd $SOCKET 1 1 $FZF_PREVIEW_COLUMNS $FZF_PREVIEW_LINES {}' \
    --bind 'ctrl-l:execute(xdg-open {})' --bind 'ctrl-d:reload(trash {}; fd -t f -L -0 . $PICS | xargs --null ls -t )' \
    --header "CTRL-d to Delete | CTRL-l to open without closing" | xargs -I _ nitrogen --set-zoom-fill --save _ >/dev/null 2>&1

kill -TERM $UB_PID
